(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{64728:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return ge}});var t,i=r(15861),o=r(87757),c=r.n(o),a=r(32777),s=r(67294),u=r(44586),l=r(1828),d=r(68758),f=r(85893),m=(0,s.forwardRef)((function(e,n){var r=(0,s.useContext)(d.I),i=r.selectedMode,o=(r.setSelectedMode,r.brushSize),c=r.selectedColor,m=e.onAddPath,h=e.onObjectRemove;(0,s.useEffect)((function(){(t=v()).freeDrawingBrush.color="black",t.freeDrawingBrush.width=3,t.hoverCursor="pointer"}),[]),(0,s.useEffect)((function(){t.freeDrawingBrush.color=c,t.renderAll()}),[c]),(0,s.useEffect)((function(){if(t)return p()}),[t,i]),(0,s.useEffect)((function(){t.freeDrawingBrush.width=o,t.renderAll()}),[o]),(0,s.useEffect)((function(){i===l.XK?t.isDrawingMode=!0:t.isDrawingMode=!1,t.renderAll()}),[i]);var v=function(){var e={isDrawingMode:!0,width:window.innerWidth,height:window.innerHeight,backgroundColor:"rgba(0,0,0,0)"};return new a.fabric.Canvas("c",e)},p=function(){return t.on("path:created",(function(e){e.path.set({id:(0,u.Z)()}),m(e.path.toObject(["id"]))})),t.on("mouse:down",(function(e){e.target&&i===l.Qd&&(t.remove(e.target),t.renderAll())})),t.on("mouse:over",(function(e){e.target&&i===l.Qd&&(e.target.set("opacity",.5),t.renderAll())})),t.on("mouse:out",(function(e){e.target&&i===l.Qd&&(e.target.set("opacity",1),t.renderAll())})),t.on("object:removed",(function(e){h(e.target.id)})),function(){t.__eventListeners={}}};(0,s.useImperativeHandle)(n,(function(){return{getCanvasAsJSON:g,loadFromJSON:x,addObject:C,removeObject:j}}));var j=function(e){e&&t.getObjects().forEach((function(n){n.id===e&&(O(n,1,0,(function(){t.remove(n)})),t.renderAll())}))},g=function(){return t.toJSON(["id"])},x=function(e){t.loadFromJSON(e)},C=function(e,n){a.fabric.util.enlivenObjects([e],(function(e){e.forEach((function(e){t.add(e),O(e,0,1)}))}))},O=function(e,n,r,i){a.fabric.util.animate({startValue:n,endValue:r,duration:150,onChange:function(n){e.opacity=n,t.renderAll()},onComplete:i})};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("style",{children:b}),(0,f.jsx)("div",{className:"canvas-box",children:(0,f.jsx)("canvas",{id:"c"})})]})})),b=function(e){var n=e.selectedMode;return"\n    .canvas-box {\n        display:inline-block;\n        width:100vw;\n        height:100vh;\n        cursor: ".concat(n?"pointer":"normal",";\n    }\n")},h=m,v=r(11163),p=r(70231),j=r(4942),g="JOIN",x="JOIN_ACKNOWLEDGE",C="ADD_MEMBER",O="REMOVE_MEMBER",w="MAKE_SUBCLIENT_MAINCLIENT",M="ADD_OBJECT",k="MAKE_THE_MEMBER_MAINCLIENT",y="REMOVE_OBJECT";function S(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function N(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?S(Object(r),!0).forEach((function(n){(0,j.Z)(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}var E=function(){var e=(0,i.Z)(c().mark((function e(n){var r,t,i,o,a,s,u,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.client,t=n.goBack,e.prev=1,i=r.getPublicKey(),o={identifier:r.identifier,name:r.name},a=A(g,o),e.next=7,D({address:i,message:a,client:r});case 7:return s=e.sent,console.log("Received join acknowledge message and canvas data"),s=JSON.parse(s),u=s.content.fabricJSON,l=s.content.currentMembers,e.abrupt("return",{fabricJSON:u,currentMembers:l});case 15:e.prev=15,e.t0=e.catch(1),alert("Unable to join room"),t();case 19:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(n){return e.apply(this,arguments)}}(),P=function(e){var n=e.memberToMakeMainClient,r=e.client,t=e.identifiersOfMembersToBeUpdated,i=r.getPublicKey(),o={identifier:n},c=t.map((function(e){return"".concat(e,".").concat(i)})),a=A(k,o);D({address:c,message:a,client:r})},_=function(e){var n=e.client,r=e.members,t=e.message,i=n.getPublicKey();z(n)?r=(r=r.filter((function(e){return""!==e.identifier}))).map((function(e){return"".concat(e.identifier,".").concat(i)})):(r=r.filter((function(e){return e.identifier!==n.identifier&&""!==e.identifier})).map((function(e){return"".concat(e.identifier,".").concat(i)}))).push(i),0!==r.length&&D({address:r,message:t,client:n})};var T=function(e){var n=e.client,r=e.newMember,t=e.membersToNotify,i={newMember:r,newMemberName:e.newMemberName},o=n.getPublicKey();t=t.map((function(e){return"".concat(e,".").concat(o)}));var c=A(C,i);D({address:t,message:c,client:n})},A=function(e,n){var r={type:e,content:n};return JSON.stringify(r)},z=function(e){return""===e.identifier},D=function(){var e=(0,i.Z)(c().mark((function e(n){var r,t,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.address,t=n.message,i=n.client,e.prev=1,console.log(""),console.log("Sending message..."),console.log(JSON.parse(t)),console.log("to address ".concat(r)),console.log(""),e.next=9,i.send(r,t);case 9:return o=e.sent,e.abrupt("return",o);case 13:e.prev=13,e.t0=e.catch(1),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(n){return e.apply(this,arguments)}}(),J={join:E,handleReception:function(e){var n=e.client,r=e.message,t=JSON.parse(r.payload),i=r.src;return z(n)?function(e){var n=e.payload,r=e.getCanvasAsJSON,t=e.addMember,i=e.client,o=e.removeSubClientMember,c=e.addObjectToCanvas,a=e.notifyJoin,s=e.notifyLeave,u=e.removeObject,l=e.src;switch(n.type){case g:var d=n.content.identifier,f=n.content.name;a({name:f});var m=t({identifier:d,name:f}),b={fabricJSON:r(),currentMembers:m},h=A(x,b),v=function(e){return e!==d&&""!==e},p=m.map((function(e){return e.identifier})).filter(v);return T({client:i,newMember:d,membersToNotify:p,newMemberName:f}),h;case O:var j=n.content.identifier;s(j),o(j);break;case M:c(n.content.newObject,l);break;case y:u(n.content.id)}}(N(N({},e),{},{payload:t,src:i})):function(e){var n=e.payload,r=e.addMember,t=e.makeThisMainClient,i=e.addObjectToCanvas,o=e.notifyJoin,c=e.makeTheMemberMainClient,a=e.removeSubClientMember,s=e.notifyLeave,u=e.removeObject,l=e.src;switch(n.type){case C:var d=n.content.newMember,f=n.content.newMemberName;o({name:f}),r({identifier:d,name:f});break;case O:var m=n.content.identifier;s(m),a(m);break;case w:s(""),t();break;case k:var b=n.content.identifier;s(""),c(b);break;case M:i(n.content.newObject,l);break;case y:u(n.content.id)}}(N(N({},e),{},{payload:t,src:i}))},sendLeaveMessageForSubClient:function(e){var n=e.client,r=e.members,t=n.getPublicKey(),i={identifier:n.identifier},o=r.map((function(e){return e.identifier})).filter((function(e){return e!==n.identifier&&""!==e})).map((function(e){return"".concat(e,".").concat(t)}));o.push(t);var c=A(O,i);n.send(o,c)},makeSubClientMainClient:function(e){var n=e.client,r=e.members;if(0!==r.length){var t=function(e){return""!==e.identifier},i=r.filter(t)[0].identifier,o=n.getPublicKey(),c=r.filter(t).map((function(e){return e.identifier})).filter((function(e){return e!=i}));P({memberToMakeMainClient:i,client:n,identifiersOfMembersToBeUpdated:c});var a=A(w);n.send("".concat(i,".").concat(o),a)}},addObjectOnOthersCanvas:function(e){var n=e.client,r=e.newObject,t=e.members,i=A(M,{newObject:r});_({client:n,members:t,message:i})},removeObjectFromOthersCanvas:function(e){var n=e.client,r=e.id,t=e.members,i=A(y,{id:r});_({client:n,members:t,message:i})}},I=r(15785);function B(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function R(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?B(Object(r),!0).forEach((function(n){(0,j.Z)(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}var L=function(e){var n=e.members,r=e.setMembers,t=e.identifier,i=e.name;if(!n.map((function(e){return e.identifier})).includes(t)&&t){var o=[].concat((0,I.Z)(n),[{identifier:t,name:i}]);return r(o),o}},K=function(e){var n=e.client,r=e.members,t=e.setMembers,i=e.setIsMainClient,o=e.setClient,c=e.setLoading,a=e.createClient,s=e.handleSharePopupClose,u=n.identifier;t(r.filter((function(e){return""!==e.identifier})).map((function(e){return e.identifier===u?R(R({},e),{},{identifier:""}):e}))),i(!0);var l=a({id:n.getSeed(),isMainClient:!0});c(!0),o(l),l.onConnect((function(){s(!1),c(!1)}))},Z=function(e){var n=e.members,r=e.setMembers,t=e.memberToRemove;r(n.filter((function(e){return e.identifier!==t})))},F=function(e){var n=e.members,r=e.setMembers,t=e.memberToMakeMainClient;r(n.filter((function(e){return""!==e.identifier})).map((function(e){return e.identifier===t?R(R({},e),{},{identifier:""}):e})))},V=function(e){var n=e.id,r=e.members,t=n.split("."),i=t[0];return 1===t.length?r.find((function(e){return""===e.identifier})).name:r.find((function(e){return e.identifier===i})).name},X=r(53850),Q=r(38448),U=r(40829),W=function(){return(0,f.jsx)(X.W,{children:(0,f.jsx)(Q.M,{height:"100vh",children:(0,f.jsx)(U.$,{thickness:"4px",speed:"0.65s",emptyColor:"gray.200",color:"#1A365D",size:"xl"})})})},H=r(57811),q=r(26081),G=r(92572);var $=function(e){var n=e.show,r=e.setName,t=e.name,i=e.onClose,o=e.onNameSubmit;return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(H.u_,{closeOnOverlayClick:!1,isCentered:!0,isOpen:n,onClose:i,closeOnEsc:!1,children:[(0,f.jsx)(H.ZA,{}),(0,f.jsxs)(H.hz,{children:[(0,f.jsx)(H.xB,{children:"Enter your name and continue"}),(0,f.jsx)(H.fe,{children:(0,f.jsx)(q.I,{onKeyDown:function(e){"Enter"===e.key&&t&&o()},onChange:function(e){r(e.target.value)},placeholder:"Enter here"})}),(0,f.jsx)(H.mz,{children:(0,f.jsx)(G.z,{isDisabled:!t,variant:"primary",mr:3,size:"sm",onClick:o,children:"Submit"})})]})]})})},Y=r(22873),ee=r(28488),ne=r(73955);var re=function(e){var n=e.shareLink,r=e.onClose,t=e.show,i=(0,Y.V)(n),o=i.hasCopied,c=i.onCopy;return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(H.u_,{size:"xl",isCentered:!0,onClose:r,isOpen:t,children:[(0,f.jsx)(H.ZA,{}),(0,f.jsxs)(H.hz,{children:[(0,f.jsx)(H.xB,{children:"Anybody with the below Id can join this room"}),(0,f.jsx)(H.fe,{children:(0,f.jsxs)(ee.B,{size:"md",children:[(0,f.jsx)(q.I,{isReadOnly:!0,value:n,pr:"4.5rem"}),(0,f.jsx)(ne.x,{width:"4.5rem",children:(0,f.jsx)(G.z,{variant:"primary",onClick:function(){setTimeout((function(){r()}),800),c()},h:"1.75rem",size:"sm",children:o?"Copied":"Copy"})})]})}),(0,f.jsx)(H.mz,{})]})]})})},te=r(40980),ie=r(72026),oe=r(64115);var ce=function(e){var n=e.show,r=e.onClose,t=e.members;return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(H.u_,{size:"sm",onClose:r,isCentered:!0,isOpen:n,children:[(0,f.jsx)(H.ZA,{}),(0,f.jsxs)(H.hz,{children:[(0,f.jsx)(H.xB,{alignSelf:"center",children:"Members present in the room"}),(0,f.jsx)(H.ol,{}),(0,f.jsx)(H.fe,{alignItems:"center",children:(0,f.jsx)(Q.M,{children:(0,f.jsx)(ie.gC,{children:t.map((function(e){var n=e.name,r=e.identifier;return(0,f.jsx)(oe.x,{fontWeight:"bold",children:n},r)}))})})}),(0,f.jsx)(H.mz,{})]})]})})},ae=r(24619),se=r(94096),ue=r(81271),le=r(48017),de=r(89583),fe=r(47516),me=r(63750),be=r(93565),he="\n  .normal {\n    color:black;\n    background-color:white;\n    border:1px solid black;\n    border-radius:20px;\n  }\n  *:focus {\n    outline: 0 !important;\n    box-shadow: 0 0 0 0 rgba(0, 0, 0, 0) !important;\n  }\n  .normal:hover {\n    color:black;\n    background-color:white;\n    border:1px solid black;\n    border-radius:20px;\n  }\n  .selected {\n    color:white;\n    background-color:black;\n    border-radius:20px;\n  }\n  .selected:hover {\n    color:white;\n    background-color:black;\n    border-radius:20px;\n  }\n  .color-picker {\n    color:black;\n    background-color:white;\n    border:1px solid black;\n    border-radius:20px;\n  }\n  .color-picker:hover {\n    color:black;\n    background-color:white;\n    border:1px solid black;\n    border-radius:20px;\n  }\n",ve=function(e){var n=e.onMembersIconClick,r=e.onShareIconClick,t=(0,s.useContext)(d.I),i=t.selectedMode,o=t.setSelectedMode,c=t.setBrushSize,a=t.selectedColor,u=t.setSelectedColor,m=function(){o(l.XK)};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("style",{children:he}),(0,f.jsx)(ae.v2,{children:(0,f.jsxs)(se.k,{width:"100vw",p:"3",justifyContent:"space-between",boxShadow:"md",children:[(0,f.jsxs)(se.k,{justifyContent:"row",children:[(0,f.jsx)(G.z,{onClick:function(){m(l.XK)},className:i===l.XK?"selected":"normal",children:(0,f.jsx)(de.KHI,{size:"20px"})}),(0,f.jsxs)(ue.iR,{marginLeft:"4",width:"100px","aria-label":"slider-ex-1",defaultValue:50,onChange:function(e){o(l.XK),c(e/10)},min:10,max:150,children:[(0,f.jsx)(ue.Uj,{children:(0,f.jsx)(ue.Ms,{})}),(0,f.jsx)(ue.gs,{_hover:{backgroundColor:"black"},borderWidth:"2px",borderColor:"black",boxShadow:"xs"})]}),(0,f.jsxs)(ae.v2,{onOpen:function(){o(l.XD)},onClose:function(){setTimeout((function(){m()}),10)},children:[(0,f.jsx)(ae.j2,{_active:{bg:"white"},className:"color-picker",marginLeft:"4",as:G.z,children:(0,f.jsx)(le.xu,{boxShadow:"xs",width:"15px",height:"15px",bg:a})}),(0,f.jsx)(ae.qy,{className:"colorpicker",border:"none",boxShadow:"none",marginTop:"3",children:(0,f.jsx)(be.e8,{Button:!0,onChangeComplete:function(e){u(e.hex)}})})]}),(0,f.jsx)(G.z,{marginLeft:"4",className:i===l.Qd?"selected":"normal",onClick:function(){o(l.Qd)},children:(0,f.jsx)(fe._xV,{size:"20px"})})]}),(0,f.jsxs)(ie.Ug,{position:"relative",right:"0",children:[(0,f.jsx)(G.z,{onClick:n,variant:"menuButton",children:(0,f.jsx)(me.rVC,{size:"20px",color:"black"})}),(0,f.jsx)(G.z,{onClick:r,variant:"menuButton",children:(0,f.jsx)(fe.Sz6,{size:"20px",color:"black"})})]})]})})]})};var pe=function(e){var n=e.loading;return"\n  .canvas-outer {\n    visibility:".concat(n?"hidden":"visible",";\n  }  \n")},je=function(){var e=(0,s.useContext)(d.I),n=e.client,r=e.setClient,t=e.members,o=e.setMembers,a=e.isMainClient,u=e.setIsMainClient,l=(0,v.useRouter)(),m=(0,s.useState)(!0),b=m[0],j=m[1],g=(0,s.useRef)(null),x=(0,s.useRef)([]),C=(0,s.useRef)(null),O=(0,s.useState)(!0),w=O[0],M=O[1],k=(0,s.useState)(!1),y=k[0],S=k[1],N=(0,s.useState)(!1),E=N[0],P=N[1],_=(0,s.useState)(""),T=_[0],A=_[1],z=(0,s.useState)(""),D=z[0],I=z[1],B=(0,te.useToast)();(0,s.useEffect)((function(){if(C.current=n,C.current)return C.current.onMessage(H),function(){return C.current.onMessage(null)}}),[n]),(0,s.useEffect)((function(){return U()}),[n]),(0,s.useEffect)((function(){x.current=t}),[t]);var R=l.query.id;(0,s.useEffect)((function(){R&&(X(),a&&n.onConnect((function(){S(!0),j(!1)})))}),[R]);var X=function(){A(R)},Q=function(){return(0,i.Z)(c().mark((function e(){var n,r,t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J.join({client:C.current,name:D,goBack:de});case 2:n=e.sent,r=n.fabricJSON,t=n.currentMembers,ee(r),o(t),j(!1);case 8:case"end":return e.stop()}}),e)})))},U=function(){return window.onbeforeunload=function(){return a?J.makeSubClientMainClient({client:C.current,members:x.current}):J.sendLeaveMessageForSubClient({client:C.current,members:x.current}),null},function(){return window.onbeforeunload=null}},H=function(e){return J.handleReception({message:e,client:n,getCanvasAsJSON:Y,addMember:ie,makeThisMainClient:se,addObjectToCanvas:ne,notifyJoin:ue,removeSubClientMember:oe,makeTheMemberMainClient:ae,notifyLeave:le,removeObject:g.current.removeObject})},q=function(){M(!1)},G=function(){S(!1)},Y=function(){return JSON.stringify(g.current.getCanvasAsJSON())},ee=function(e){g.current&&g.current.loadFromJSON(e,(function(){g.current.renderAll()}))},ne=function(e,n){var r=V({id:n,members:x.current});g.current.addObject(e,r)},ie=function(e){var n=e.identifier,r=e.name;return L({members:x.current,setMembers:o,identifier:n,name:r})},oe=function(e){return Z({members:x.current,setMembers:o,memberToRemove:e})},ae=function(e){return F({members:x.current,setMembers:o,memberToMakeMainClient:e})},se=function(){return K({members:x.current,setMembers:o,client:C.current,setIsMainClient:u,setClient:r,setLoading:j,createClient:p.ZP.createClient,handleSharePopupClose:G})},ue=function(e){var n=e.name;B({title:"".concat(n," just joined"),duration:2e3,isClosable:!0,status:"success"})},le=function(e){var n=x.current.find((function(n){return n.identifier===e})).name;B({title:"".concat(n," just left"),duration:2e3,isClosable:!0,status:"warning"})},de=function(e){j(!1),l.push("/")};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("style",{children:pe({loading:b})}),b?(0,f.jsx)(W,{}):null,(0,f.jsx)(ve,{onShareIconClick:function(){S(!0)},onMembersIconClick:function(){P(!0)}}),(0,f.jsxs)("div",{className:"canvas-outer",children:[(0,f.jsx)(ce,{members:x.current,onClose:function(){P(!1)},show:E}),(0,f.jsx)($,{name:D,setName:I,shareLink:T,show:w,onClose:q,onNameSubmit:function(){if(a){var e=C.current;e.name=D,r(e),o([{name:D,identifier:""}])}else!function(){j(!0);var e=p.ZP.createClient({id:R,isMainClient:!1});e.name=D,r(e),e.onConnect(Q(e))}();q()}}),(0,f.jsx)(re,{show:y&&!w,onClose:G,shareLink:T}),(0,f.jsx)(h,{onAddPath:function(e){J.addObjectOnOthersCanvas({client:C.current,newObject:e,members:x.current})},onObjectRemove:function(e){J.removeObjectFromOthersCanvas({client:C.current,id:e,members:x.current})},ref:g})]})]})};var ge=function(){return(0,f.jsx)(je,{})}},70231:function(e,n,r){"use strict";r.d(n,{Q0:function(){return c}});var t=r(38357),i=r.n(t),o=r(44586),c=function(e){try{return new(i().Client)({seed:e}),!0}catch(n){return!1}};n.ZP={createClient:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.id,r=e.isMainClient,t=new(i().Client)({seed:n,identifier:r?void 0:(0,o.Z)()});return console.log(t),t}}},67592:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/drawingboard/[id]",function(){return r(64728)}])},80950:function(){},46601:function(){},89214:function(){},8623:function(){},7748:function(){},85568:function(){},24960:function(){},26759:function(){},56272:function(){},75992:function(){},56619:function(){},77108:function(){},52361:function(){},94616:function(){},55024:function(){}},function(e){e.O(0,[774,78,29,445,13,874,498,597,394,888,179],(function(){return n=67592,e(e.s=n);var n}));var n=e.O();_N_E=n}]);